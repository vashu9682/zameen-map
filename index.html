<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>भूमि मापन उपकरण | Land Measurement Tool</title>
    <style>
        :root {
            --primary: #4285F4;
            --secondary: #34A853;
            --danger: #EA4335;
            --warning: #FBBC05;
            --dark: #202124;
            --light: #f8f9fa;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
            }
        }
        
        .map-container {
            flex: 2;
            height: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .controls {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .results {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: auto;
        }
        
        .result-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--dark);
        }
        
        .result-value {
            font-weight: 500;
            color: var(--primary);
        }
        
        .shape-info {
            background-color: var(--secondary);
            color: white;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            color: #666;
            font-size: 14px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 767px) {
            .map-container {
                height: 400px;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>भूमि मापन उपकरण</h1>
            <p>मानचित्र पर बिंदु चुनकर जमीन का क्षेत्रफल और सीमाएँ मापें</p>
        </header>
        
        <div class="app-container">
            <div class="map-container">
                <div id="map"></div>
            </div>
            
            <div class="controls">
                <div class="shape-info" id="shape-info">
                    कोई आकार नहीं बनाया गया
                </div>
                
                <div class="btn-group">
                    <button id="clear-btn" class="btn btn-danger">मिटाएं</button>
                    <button id="undo-btn" class="btn btn-warning">पिछला हटाएं</button>
                </div>
                
                <div class="input-group">
                    <input type="text" id="lat-input" placeholder="अक्षांश (Latitude)">
                    <input type="text" id="lng-input" placeholder="देशांतर (Longitude)">
                </div>
                <button id="add-point-btn" class="btn btn-primary">बिंदु जोड़ें</button>
                
                <div class="results">
                    <div class="result-item">
                        <span class="result-label">आकार:</span>
                        <span class="result-value" id="shape-type">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">परिमाप:</span>
                        <span class="result-value" id="perimeter">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">क्षेत्रफल:</span>
                        <span class="result-value" id="area">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">विवरण:</span>
                        <span class="result-value" id="details">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            © 2023 भूमि मापन उपकरण | Google Maps API का उपयोग करता है
        </footer>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=geometry"></script>
    <script>
        // Initialize the map
        let map;
        let markers = [];
        let polygon = null;
        let polyline = null;
        
        // Unit conversion factors (approximate)
        const unitConversions = {
            sqm: {
                sqft: 10.764,
                bigha: 0.00025, // UP standard
                dismil: 0.0247,
                kattha: 0.005
            }
        };
        
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 28.6139, lng: 77.2090 }, // Default to Delhi
                zoom: 15,
                gestureHandling: "greedy"
            });
            
            // Add click listener to the map
            map.addListener("click", (event) => {
                addPoint(event.latLng);
                updateShape();
            });
            
            // Initialize buttons
            document.getElementById("clear-btn").addEventListener("click", clearAll);
            document.getElementById("undo-btn").addEventListener("click", undoLast);
            document.getElementById("add-point-btn").addEventListener("click", addManualPoint);
        }
        
        function addPoint(latLng) {
            const marker = new google.maps.Marker({
                position: latLng,
                map: map,
                label: (markers.length + 1).toString(),
                draggable: true
            });
            
            marker.addListener("dragend", () => {
                updateShape();
            });
            
            markers.push(marker);
            updatePolylines();
        }
        
        function updatePolylines() {
            // Remove existing polyline/polygon
            if (polyline) polyline.setMap(null);
            if (polygon) polygon.setMap(null);
            
            if (markers.length < 2) return;
            
            const path = markers.map(marker => marker.getPosition());
            
            if (markers.length === 2) {
                // For line
                polyline = new google.maps.Polyline({
                    path: path,
                    geodesic: true,
                    strokeColor: "#FF0000",
                    strokeOpacity: 1.0,
                    strokeWeight: 3,
                    map: map
                });
            } else if (markers.length >= 3) {
                // For polygon
                polygon = new google.maps.Polygon({
                    paths: path,
                    strokeColor: "#4285F4",
                    strokeOpacity: 0.8,
                    strokeWeight: 3,
                    fillColor: "#4285F4",
                    fillOpacity: 0.35,
                    map: map
                });
            }
        }
        
        function updateShape() {
            const shapeInfo = document.getElementById("shape-info");
            const shapeTypeEl = document.getElementById("shape-type");
            const perimeterEl = document.getElementById("perimeter");
            const areaEl = document.getElementById("area");
            const detailsEl = document.getElementById("details");
            
            if (markers.length === 0) {
                shapeInfo.textContent = "कोई आकार नहीं बनाया गया";
                shapeTypeEl.textContent = "-";
                perimeterEl.textContent = "-";
                areaEl.textContent = "-";
                detailsEl.textContent = "-";
                return;
            }
            
            const positions = markers.map(marker => marker.getPosition());
            
            // Calculate perimeter (sum of all sides)
            let perimeter = 0;
            for (let i = 0; i < positions.length; i++) {
                const nextIndex = (i + 1) % positions.length;
                perimeter += google.maps.geometry.spherical.computeDistanceBetween(
                    positions[i],
                    positions[nextIndex]
                );
            }
            
            // Calculate area
            let area = 0;
            let shapeType = "बहुभुज";
            
            if (markers.length === 2) {
                shapeType = "रेखा";
                area = 0;
            } else if (markers.length === 3) {
                shapeType = "त्रिभुज";
                // Calculate using Heron's formula
                const a = google.maps.geometry.spherical.computeDistanceBetween(positions[0], positions[1]);
                const b = google.maps.geometry.spherical.computeDistanceBetween(positions[1], positions[2]);
                const c = google.maps.geometry.spherical.computeDistanceBetween(positions[2], positions[0]);
                const s = (a + b + c) / 2;
                area = Math.sqrt(s * (s - a) * (s - b) * (s - c));
            } else if (markers.length === 4) {
                // Check if it's a rectangle
                const sides = [
                    google.maps.geometry.spherical.computeDistanceBetween(positions[0], positions[1]),
                    google.maps.geometry.spherical.computeDistanceBetween(positions[1], positions[2]),
                    google.maps.geometry.spherical.computeDistanceBetween(positions[2], positions[3]),
                    google.maps.geometry.spherical.computeDistanceBetween(positions[3], positions[0])
                ];
                
                const diagonals = [
                    google.maps.geometry.spherical.computeDistanceBetween(positions[0], positions[2]),
                    google.maps.geometry.spherical.computeDistanceBetween(positions[1], positions[3])
                ];
                
                // Check if opposite sides are equal and diagonals are equal
                if (Math.abs(sides[0] - sides[2]) < sides[0] * 0.1 && 
                    Math.abs(sides[1] - sides[3]) < sides[1] * 0.1 &&
                    Math.abs(diagonals[0] - diagonals[1]) < diagonals[0] * 0.1) {
                    
                    if (Math.abs(sides[0] - sides[1]) < sides[0] * 0.1) {
                        shapeType = "वर्ग";
                    } else {
                        shapeType = "आयत";
                    }
                    area = sides[0] * sides[1];
                } else {
                    shapeType = "चतुर्भुज";
                    // Use shoelace formula for irregular quadrilaterals
                    area = computeShoelaceArea(positions);
                }
            } else if (markers.length > 4) {
                shapeType = "बहुभुज (" + markers.length + " भुजाएँ)";
                area = computeShoelaceArea(positions);
            }
            
            // Update UI
            shapeInfo.textContent = `${shapeType} बनाया गया (${markers.length} बिंदु)`;
            shapeTypeEl.textContent = shapeType;
            perimeterEl.textContent = `${perimeter.toFixed(2)} मीटर (${(perimeter * 3.28084).toFixed(2)} फुट)`;
            
            if (area > 0) {
                areaEl.innerHTML = `
                    ${area.toFixed(2)} वर्ग मीटर<br>
                    ${(area * unitConversions.sqm.sqft).toFixed(2)} वर्ग फुट<br>
                    ${(area * unitConversions.sqm.bigha).toFixed(4)} बीघा<br>
                    ${(area * unitConversions.sqm.dismil).toFixed(2)} डिसमिल<br>
                    ${(area * unitConversions.sqm.kattha).toFixed(2)} कट्ठा
                `;
            } else {
                areaEl.textContent = "-";
            }
            
            // Show side lengths for triangles and quadrilaterals
            if (markers.length >= 3 && markers.length <= 4) {
                let sideDetails = "";
                for (let i = 0; i < positions.length; i++) {
                    const nextIndex = (i + 1) % positions.length;
                    const distance = google.maps.geometry.spherical.computeDistanceBetween(
                        positions[i],
                        positions[nextIndex]
                    );
                    sideDetails += `भुजा ${i+1}: ${distance.toFixed(2)} मीटर<br>`;
                }
                detailsEl.innerHTML = sideDetails;
            } else {
                detailsEl.textContent = "-";
            }
        }
        
        function computeShoelaceArea(vertices) {
            // Using Google's geometry library for more accurate spherical calculations
            return google.maps.geometry.spherical.computeArea(vertices);
        }
        
        function clearAll() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            if (polyline) polyline.setMap(null);
            if (polygon) polygon.setMap(null);
            updateShape();
        }
        
        function undoLast() {
            if (markers.length === 0) return;
            
            const lastMarker = markers.pop();
            lastMarker.setMap(null);
            updatePolylines();
            updateShape();
        }
        
        function addManualPoint() {
            const latInput = document.getElementById("lat-input");
            const lngInput = document.getElementById("lng-input");
            
            const lat = parseFloat(latInput.value);
            const lng = parseFloat(lngInput.value);
            
            if (isNaN(lat) || isNaN(lng)) {
                alert("कृपया वैध अक्षांश और देशांतर दर्ज करें");
                return;
            }
            
            if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
                alert("अमान्य निर्देशांक: अक्षांश -90 से 90 और देशांतर -180 से 180 के बीच होना चाहिए");
                return;
            }
            
            addPoint(new google.maps.LatLng(lat, lng));
            updateShape();
            
            // Clear inputs
            latInput.value = "";
            lngInput.value = "";
        }
        
        // Initialize the map when the window loads
        window.onload = initMap;
    </script>
</body>
</html>